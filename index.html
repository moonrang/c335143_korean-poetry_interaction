<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>C335143_문래원_TextRain_Final_PadSafe</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap"
      rel="stylesheet"
    />

    <style>
      @font-face {
        font-family: "Shilla";
        src: url("https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2206-02@1.0/Shilla_CultureB-Bold.woff2")
          format("woff2");
      }

      html,
      body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
        overscroll-behavior: none;
        touch-action: none;
        background-color: #f4f1ea;
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
        font-family: "Shilla", serif;
      }

      #sketch-display {
        position: absolute;
        z-index: 1;
        mix-blend-mode: multiply;
        transition: all 0.5s ease;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        /* 넘치는 부분 잘라내기 */
        overflow: hidden; 
      }

      /* [수정 1] iframe 강제 축소 (80% 줌 효과) */
      #sketch-iframe {
        border: none;
        display: block;
        background: transparent;
        transition: opacity 0.5s ease;

        /* 너비/높이를 125%로 설정하고 */
        width: 125%;
        height: 125%;
        /* 크기를 0.8배(80%)로 줄임 -> 결과적으로 100% 영역에 딱 맞게 들어감 */
        transform: scale(0.8);
        transform-origin: 0 0; /* 왼쪽 위 기준 축소 */
      }

      #ipad-touch-shield {
        display: none;
      }

      .nav-container {
        position: absolute;
        top: 40px;
        left: 40px;
        z-index: 100;
        display: flex;
        flex-direction: column;
        gap: 20px;
        width: 60px;
        align-items: center;
        transition: all 0.3s ease;
      }

      .seal-btn {
        width: 55px;
        height: 55px;
        background: transparent;
        border: 2px solid #bbb;
        color: #aaa;
        font-family: "Ma Shan Zheng", serif;
        font-size: 26px;
        line-height: 1;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        transition: all 0.3s ease;
        opacity: 0.6;
        touch-action: manipulation;
      }

      .seal-btn:hover {
        border-color: #888;
        color: #555;
        opacity: 0.9;
        transform: scale(1.05);
      }

      .seal-btn.active {
        background-color: #ba1e1e;
        color: #fcf8f0;
        border: none;
        filter: url("#ink-bleed") drop-shadow(2px 2px 3px rgba(80, 0, 0, 0.25));
        mix-blend-mode: multiply;
        box-shadow: inset 2px 2px 15px rgba(50, 0, 0, 0.4);
        animation: stamp-impact 0.4s cubic-bezier(0.25, 1, 0.5, 1) forwards;
        text-shadow: 1px 1px 0px rgba(50, 0, 0, 0.3);
        opacity: 1;
      }

      @keyframes stamp-impact {
        0% {
          transform: scale(1) rotate(0deg);
          opacity: 0.6;
        }
        40% {
          transform: scale(0.8) rotate(-2deg);
        }
        60% {
          transform: scale(1.2) rotate(-5deg);
        }
        100% {
          transform: scale(1.1) rotate(-3deg);
          opacity: 1;
        }
      }

      .page-label {
        position: absolute;
        top: 40px;
        left: 110px;
        writing-mode: vertical-rl;
        text-orientation: upright;
        font-family: "Shilla", serif;
        font-size: 16px;
        font-weight: bold;
        color: #555;
        letter-spacing: 6px;
        opacity: 0;
        transition: opacity 0.5s;
        pointer-events: none;
        border-left: 1px solid rgba(0, 0, 0, 0.1);
        padding-left: 12px;
        height: 220px;
      }

      .nav-container:hover + .page-label {
        opacity: 0.8;
      }

      @media (max-width: 1024px) {
        #sketch-display {
          width: 85%;
          height: 90%;
          left: 15%;
          top: 5%;
        }
        .nav-container {
          top: 30px;
          left: 20px;
          gap: 15px;
          width: 45px;
        }
        .seal-btn {
          width: 48px;
          height: 48px;
          font-size: 22px;
        }
        .page-label {
          top: 30px;
          left: 80px;
          font-size: 14px;
          height: 180px;
        }
      }

      @media (max-width: 480px) {
        #sketch-display {
          width: 82%;
          left: 18%;
        }
      }

      .svg-filters {
        position: absolute;
        width: 0;
        height: 0;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <svg class="svg-filters">
      <defs>
        <filter id="ink-bleed" x="-50%" y="-50%" width="200%" height="200%">
          <feTurbulence
            type="fractalNoise"
            baseFrequency="0.06"
            numOctaves="5"
            result="noise"
          />
          <feDisplacementMap
            in="SourceGraphic"
            in2="noise"
            scale="6"
            xChannelSelector="R"
            yChannelSelector="G"
          />
          <feGaussianBlur stdDeviation="0.4" />
          <feComponentTransfer>
            <feFuncA type="linear" slope="1.5" intercept="-0.2" />
          </feComponentTransfer>
        </filter>
      </defs>
    </svg>

    <div id="sketch-display">
      <iframe id="sketch-iframe"></iframe>
    </div>

    <div class="nav-container" id="nav-box"></div>
    <div class="page-label" id="label-text"></div>

    <script>
      const sketches = [
        "page1/index.html",
        "page2/index.html",
        "page3/index.html",
        "page4/index.html",
      ];
      const kanjiNums = ["一", "二", "三", "四", "五"];

      const iframe = document.getElementById("sketch-iframe");
      const navBox = document.getElementById("nav-box");
      const labelText = document.getElementById("label-text");
      let currentIndex = 0;

      function getRandomMorphShape() {
        const r = () => Math.floor(30 + Math.random() * 40);
        return `${r()}% ${r()}% ${r()}% ${r()}% / ${r()}% ${r()}% ${r()}% ${r()}%`;
      }

      function initNav() {
        navBox.innerHTML = "";
        sketches.forEach((_, index) => {
          const btn = document.createElement("button");
          btn.className = "seal-btn";
          btn.innerText = kanjiNums[index] || index + 1;
          btn.style.borderRadius = getRandomMorphShape();
          const randomRot = Math.random() * 10 - 5;
          btn.style.transform = `rotate(${randomRot}deg)`;
          btn.onclick = () => loadSketch(index);
          navBox.appendChild(btn);
        });
      }

      function loadSketch(index) {
        if (index < 0 || index >= sketches.length) return;
        currentIndex = index;
        
        iframe.style.opacity = 0;
        setTimeout(() => {
          iframe.src = sketches[index];
          iframe.onload = () => {
            iframe.style.opacity = 1;
          };
        }, 150);
        
        updateSeals();

        const shield = document.getElementById("ipad-touch-shield");
        if (shield) {
            if (index >= 2) {
                shield.style.display = "block";
            } else {
                shield.style.display = "none";
            }
        }
      }

      function updateSeals() {
        const buttons = document.querySelectorAll(".seal-btn");
        buttons.forEach((btn, idx) => {
          if (idx === currentIndex) {
            btn.classList.add("active");
            btn.style.animation = "none";
            btn.offsetHeight;
            btn.style.animation =
              "stamp-impact 0.4s cubic-bezier(0.25, 1, 0.5, 1) forwards";
            labelText.innerText = `제  ${kanjiNums[idx] || idx + 1}  장`;
          } else {
            btn.classList.remove("active");
            btn.style.animation = "none";
            const randomRot = Math.random() * 10 - 5;
            btn.style.transform = `rotate(${randomRot}deg)`;
          }
        });
      }

      document.addEventListener("DOMContentLoaded", () => {
        initNav();
        loadSketch(0);
      });
    </script>
  </body>

  <script>
    (function () {
      const isTouchDevice =
        navigator.maxTouchPoints > 0 || "ontouchstart" in window;
      if (!isTouchDevice) return;

      const iframe = document.getElementById("sketch-iframe");
      if (!iframe) return;

      const shield = document.createElement("div");
      shield.id = "ipad-touch-shield";
      Object.assign(shield.style, {
        position: "absolute",
        top: "0",
        left: "0",
        width: "100%",
        height: "100%",
        zIndex: "50", 
        touchAction: "none",
        background: "transparent",
        display: "none"
      });
      iframe.parentElement.appendChild(shield);

      let startX = 0, startY = 0;
      let isDragging = false;
      let touchStartTime = 0;

      // [수정 2] 좌표 보정 함수
      // iframe이 0.8배로 축소되었으므로, 터치 좌표는 반대로 1.25배(1/0.8) 튀겨줘야
      // 내부 캔버스의 정확한 위치를 찍을 수 있음.
      function sendEvent(type, x, y) {
        const iWin = iframe.contentWindow;
        if(!iWin) return;
        const iDoc = iframe.contentDocument || iWin.document;
        
        // 보정된 좌표
        const scaledX = x * 1.25;
        const scaledY = y * 1.25;

        const target = iDoc.elementFromPoint(scaledX, scaledY) || iDoc.body;
        
        if (type === "click") {
          ["mousedown", "mouseup", "click"].forEach((t) => {
            target.dispatchEvent(new MouseEvent(t, {
                bubbles: true, cancelable: true, view: iWin,
                clientX: scaledX, clientY: scaledY, buttons: 1,
            }));
          });
        } else {
          target.dispatchEvent(new MouseEvent("mousemove", {
              bubbles: true, cancelable: true, view: iWin,
              clientX: scaledX, clientY: scaledY, buttons: 0,
            }));
        }
      }

      shield.addEventListener("touchstart", (e) => {
        e.preventDefault();
        const t = e.touches[0];
        startX = t.clientX; startY = t.clientY;
        touchStartTime = Date.now();
        isDragging = false;
        sendEvent("mousemove", startX, startY);
      }, { passive: false });

      shield.addEventListener("touchmove", (e) => {
        e.preventDefault();
        const t = e.touches[0];
        const dist = Math.sqrt(Math.pow(t.clientX - startX, 2) + Math.pow(t.clientY - startY, 2));
        if (dist > 10) isDragging = true;
        sendEvent("mousemove", t.clientX, t.clientY);
      }, { passive: false });

      shield.addEventListener("touchend", (e) => {
        e.preventDefault();
        const t = e.changedTouches[0];
        if (!isDragging && Date.now() - touchStartTime < 300) {
          sendEvent("click", t.clientX, t.clientY);
        }
      }, { passive: false });
    })();
  </script>

  <script>
    document.addEventListener('gesturestart', function(e) { e.preventDefault(); });
    document.addEventListener('touchmove', function(e) { if (e.touches.length > 1) e.preventDefault(); }, { passive: false });
    let lastTouchEnd = 0;
    document.addEventListener('touchend', function(e) {
      const now = (new Date()).getTime();
      if (now - lastTouchEnd <= 300) e.preventDefault();
      lastTouchEnd = now;
    }, false);
  </script>
</html>
