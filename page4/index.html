<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>C335143_별헤는밤</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;800&display=swap"
      rel="stylesheet"
    />
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background-color: #020410;
        font-family: "Nanum Myeongjo", serif;
        cursor: none;
      }
      canvas {
        display: block;
      }

      #filter-layer {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        backdrop-filter: blur(1px) contrast(120%);
        mix-blend-mode: screen;
        z-index: 5;
      }

      #cursor {
        position: absolute;
        width: 60px;
        height: 60px;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.1) 0%,
          rgba(255, 255, 255, 0) 70%
        );
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        pointer-events: none;
        transform: translate(-50%, -50%);
        z-index: 10;
        mix-blend-mode: screen;
        box-shadow: 0 0 20px rgba(100, 150, 255, 0.2);
      }

      #guide {
        position: absolute;
        bottom: 5%;
        width: 100%;
        text-align: center;
        color: #889add;
        font-size: 0.8rem;
        letter-spacing: 2px;
        opacity: 0.7;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <div id="filter-layer"></div>
    <div id="cursor"></div>
    <div id="guide">별 하나에 추억과, 별 하나에 사랑과...</div>
    <canvas id="canvas"></canvas>

    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      const cursor = document.getElementById("cursor");

      let width, height;
      let stars = [];
      let mouse = { x: -1000, y: -1000 };

      const STAR_COUNT = 2000;
      const POEM_LINES = [
        "계절이 지나가는 하늘에는",
        "가을로 가득 차 있습니다",
        "나는 아무 걱정도 없이",
        "가을 속의 별들을 다 헤일 듯합니다",
        "별 하나에 추억과",
        "별 하나에 사랑과",
        "별 하나에 쓸쓸함과",
        "별 하나에 동경과",
        "별 하나에 시와",
        "별 하나에 어머니, 어머니",
      ];

      let sceneIndex = 0;
      const shapeCtx = document.createElement("canvas").getContext("2d");
      function scanPixels(gap = 5) {
        const data = shapeCtx.getImageData(0, 0, width, height).data;
        const points = [];
        for (let y = 0; y < height; y += gap) {
          for (let x = 0; x < width; x += gap) {
            if (data[(y * width + x) * 4 + 3] > 128) points.push({ x, y });
          }
        }
        return points;
      }

      function getTextPoints(text) {
        shapeCtx.clearRect(0, 0, width, height);
        const fontSize = Math.min(width, height) * 0.08;
        shapeCtx.font = `400 ${fontSize}px 'Nanum Myeongjo'`;
        shapeCtx.textAlign = "center";
        shapeCtx.textBaseline = "middle";
        shapeCtx.fillStyle = "white";
        shapeCtx.fillText(text, width / 2, height / 2);
        return scanPixels(4);
      }

      function getGalaxyPoints(count) {
        const points = [];
        const cx = width / 2;
        const cy = height / 2;
        for (let i = 0; i < count; i++) {
          const angle = i * 0.1;
          const dist = i * 0.3 + Math.random() * 50;
          const armOffset = (i % 3) * ((Math.PI * 2) / 3);

          points.push({
            x: cx + Math.cos(angle + armOffset) * dist * (width / 1500),
            y: cy + Math.sin(angle + armOffset) * dist * (height / 1500),
          });
        }
        return points;
      }

      class Star {
        constructor() {
          this.x = Math.random() * width;
          this.y = Math.random() * height;
          this.tx = this.x;
          this.ty = this.y;
          this.vx = 0;
          this.vy = 0;

          const chars = [
            "별",
            "꿈",
            "밤",
            "시",
            "愛",
            "☆",
            "★",
            "ㆍ",
            ".",
            "¸",
          ];
          this.text = chars[Math.floor(Math.random() * chars.length)];

          this.size = Math.random() * 2 + 0.5;
          this.targetSize = this.size;

          this.alpha = Math.random();
          this.twinkleSpeed = Math.random() * 0.05 + 0.01;

          const colors = ["#ffffff", "#dbeaff", "#fff9c4", "#a8c0ff"];
          this.color = colors[Math.floor(Math.random() * colors.length)];
        }

        update() {
          const dx = this.tx - this.x;
          const dy = this.ty - this.y;

          this.vx += dx * 0.04;
          this.vy += dy * 0.04;

          this.vx *= 0.9;
          this.vy *= 0.9;

          this.x += this.vx;
          this.y += this.vy;

          this.alpha += this.twinkleSpeed;
          const opacity = ((Math.sin(this.alpha) + 1) / 2) * 0.8 + 0.2;

          const distMouse = Math.hypot(mouse.x - this.x, mouse.y - this.y);
          const spotlightRadius = 150;

          if (distMouse < spotlightRadius) {
            this.renderSize = this.size * 3;
            this.renderAlpha = 1;
            this.x += (mouse.x - this.x) * 0.02;
            this.y += (mouse.y - this.y) * 0.02;
          } else {
            this.renderSize = this.size;
            this.renderAlpha = opacity;
          }

          this.speed = Math.hypot(this.vx, this.vy);
        }

        draw() {
          ctx.fillStyle = this.color;
          ctx.globalAlpha = this.renderAlpha;

          if (this.speed > 5) {
            ctx.beginPath();
            ctx.moveTo(this.x, this.y);
            ctx.lineTo(this.x - this.vx * 3, this.y - this.vy * 3);
            ctx.strokeStyle = this.color;
            ctx.lineWidth = this.renderSize;
            ctx.stroke();
          } else {
            if (this.renderSize < 2) {
              ctx.beginPath();
              ctx.arc(this.x, this.y, this.renderSize, 0, Math.PI * 2);
              ctx.fill();
            } else {
              ctx.font = `${this.renderSize * 4}px 'Nanum Myeongjo'`;
              ctx.fillText(this.text, this.x, this.y);
            }
          }
        }
      }

      function setTarget(points) {
        const shuffled = points.sort(() => Math.random() - 0.5);

        stars.forEach((s, i) => {
          let target;
          if (i < shuffled.length) {
            target = shuffled[i];
            if (sceneIndex > 1) {
              s.text =
                Math.random() > 0.8 ? "별" : sceneIndex % 2 === 0 ? "★" : "ㆍ";
            }
          } else {
            const angle = Math.random() * Math.PI * 2;
            const r = Math.random() * width;
            target = {
              x: width / 2 + Math.cos(angle) * r,
              y: height / 2 + Math.sin(angle) * r,
            };
          }
          s.tx = target.x;
          s.ty = target.y;
        });
      }

      function changeScene() {
        sceneIndex++;

        stars.forEach((s) => {
          s.vx += (Math.random() - 0.5) * 50;
          s.vy += (Math.random() - 0.5) * 50;
        });

        setTimeout(() => {
          let points;
          if (sceneIndex === 1) {
            points = getGalaxyPoints(STAR_COUNT);
          } else {
            const idx = (sceneIndex - 2) % POEM_LINES.length;
            points = getTextPoints(POEM_LINES[idx]);
          }
          setTarget(points);
        }, 100);
      }

      function init() {
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
        shapeCtx.canvas.width = width;
        shapeCtx.canvas.height = height;

        stars = [];
        for (let i = 0; i < STAR_COUNT; i++) stars.push(new Star());

        sceneIndex = 1;
        setTarget(getGalaxyPoints(STAR_COUNT));
      }

      function animate() {
        ctx.fillStyle = "rgba(2, 4, 16, 0.25)";
        ctx.fillRect(0, 0, width, height);

        ctx.beginPath();
        ctx.strokeStyle = "rgba(200, 220, 255, 0.15)";
        ctx.lineWidth = 0.5;

        const nearbyStars = [];
        stars.forEach((s) => {
          s.update();
          s.draw();

          const dx = mouse.x - s.x;
          const dy = mouse.y - s.y;
          if (dx * dx + dy * dy < 22500) {
            nearbyStars.push(s);
          }
        });

        for (let i = 0; i < nearbyStars.length; i++) {
          for (let j = i + 1; j < nearbyStars.length; j++) {
            const s1 = nearbyStars[i];
            const s2 = nearbyStars[j];
            const dist = Math.hypot(s1.x - s2.x, s1.y - s2.y);
            if (dist < 60) {
              ctx.moveTo(s1.x, s1.y);
              ctx.lineTo(s2.x, s2.y);
            }
          }
        }
        ctx.stroke();

        cursor.style.left = mouse.x + "px";
        cursor.style.top = mouse.y + "px";

        if (sceneIndex === 1) {
          stars.forEach((s) => {});
        }

        requestAnimationFrame(animate);
      }

      window.addEventListener("resize", init);
      window.addEventListener("mousemove", (e) => {
        mouse.x = e.clientX;
        mouse.y = e.clientY;
      });

      const handleInput = (e) => {
        if (e.type === "touchstart") {
          mouse.x = e.touches[0].clientX;
          mouse.y = e.touches[0].clientY;
        }
        changeScene();

        cursor.style.background =
          "radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 70%)";
        cursor.style.width = "100px";
        cursor.style.height = "100px";
        setTimeout(() => {
          cursor.style.background =
            "radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%)";
          cursor.style.width = "60px";
          cursor.style.height = "60px";
        }, 200);
      };

      window.addEventListener("mousedown", handleInput);
      window.addEventListener("touchstart", handleInput, { passive: false });

      init();
      animate();
    </script>
  </body>
</html>
